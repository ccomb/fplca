# =============================================================================
# PETSc/SLEPc Build Configuration
# =============================================================================
# Sourced by build.sh and Dockerfile for consistent configuration.
# This file centralizes all PETSc/SLEPc settings across all platforms.

# Versions (synced with versions.env - kept here for convenience)
# Note: versions.env is the source of truth; these are for reference
PETSC_VERSION="${PETSC_VERSION:-3.24.2}"
SLEPC_VERSION="${SLEPC_VERSION:-3.24.1}"

# Download URLs
PETSC_URL_BASE="https://web.cels.anl.gov/projects/petsc/download/release-snapshots"
SLEPC_URL_BASE="https://slepc.upv.es/download/distrib"

# Common configure options (all platforms)
# --with-cxx=0: We don't use C++
# --download-mumps: Direct solver for LCA matrices
# --download-scalapack: Required by MUMPS
# --with-debugging=no: Optimized build
# Note: MPI is platform-specific (--download-mpich on Linux/macOS, MS-MPI on Windows)
PETSC_CONFIGURE_COMMON="--with-cxx=0 --download-mumps --download-scalapack --with-debugging=no"
PETSC_COPTFLAGS="-O3"
PETSC_FOPTFLAGS="-O3"

# Platform-specific configure options
# Linux: Download MPICH and BLAS/LAPACK from source
PETSC_CONFIGURE_LINUX="--download-mpich --download-fblaslapack"

# Windows (MSYS2 UCRT64): Use MS-MPI, OpenBLAS, static linking for portability
# MS-MPI paths are handled in build.sh due to spaces in Windows paths
# Note: --with-cc and --with-fc are set in build.sh to use MSYS2 MPI wrappers (mpicc/mpifort)
PETSC_CONFIGURE_WINDOWS="--with-blaslapack-lib=/ucrt64/lib/libopenblas.a --with-shared-libraries=0 --with-single-library=1"

# Docker: Download everything for reproducibility
PETSC_CONFIGURE_DOCKER="--download-cmake --download-mpich --download-fblaslapack --download-hdf5=yes"

# macOS: Download MPICH and BLAS/LAPACK from source
PETSC_CONFIGURE_MACOS="--download-mpich --download-fblaslapack"

# Runtime PETSc options for MUMPS direct solver
# -pc_type lu: Use LU factorization
# -pc_factor_mat_solver_type mumps: Use MUMPS as solver
# -mat_mumps_icntl_14 80: Increase memory for pivoting
# -mat_mumps_icntl_24 1: Null pivot detection
PETSC_OPTIONS="-pc_type lu -pc_factor_mat_solver_type mumps -mat_mumps_icntl_14 80 -mat_mumps_icntl_24 1"

# Windows DLL dependencies (for bundling with desktop app)
# These are required by OpenBLAS and PETSc when built with MSYS2
WINDOWS_OPENBLAS_DLLS="libopenblas.dll libgcc_s_seh-1.dll libgfortran-5.dll libgomp-1.dll libwinpthread-1.dll libquadmath-0.dll"

# MSYS2 paths (for Windows builds)
MSYS2_BIN_DIR="${MSYS2_BIN_DIR:-/ucrt64/bin}"
MSYS2_LIB_DIR="${MSYS2_LIB_DIR:-/ucrt64/lib}"
